<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>꽃게당 인스타그램 TV</title>
  <style>
    body, html { margin: 0; padding: 0; width: 100vw; height: 100vh;}
    #viewer {
      width: 100vw;
      height: 100vh;
      border: none;
      display: block;
      opacity: 1;
      transition: opacity 0.6s;
    }
    #viewer.fadeout {
      opacity: 0;
    }
  </style>
</head>
<body>
  <iframe id="viewer" src="board1.html"></iframe>
<script>
  const pages = ["board1.html", "board2.html", "board3.html", "video.html", "promo.html"];
  const intervals = [3000, 3000, 3000, 5000, 4000]; // 각 페이지별 interval(ms)
  let current = 0;
  let timeoutId = null;
  const viewer = document.getElementById("viewer");

  // 프리로드 범위 설정(미리 불러올 페이지 개수)
  const PRELOAD_RANGE = 3;

  // 이미 프리로드한 링크 중복 방지
  const preloaded = new Set();

  // 여러 페이지 프리로드
  function preloadNextPages(startIdx) {
    for (let i = 1; i <= PRELOAD_RANGE; i++) {
      let idx = (startIdx + i) % pages.length;
      let page = pages[idx];
      if (!preloaded.has(page)) {
        let link = document.createElement('link');
        link.rel = 'preload';
        link.href = page;
        link.as = 'document';
        document.head.appendChild(link);
        preloaded.add(page);
      }
    }
  }

  // 다음 페이지로 전환
  function nextPage() {
    viewer.classList.add('fadeout');
    setTimeout(() => {
      current = (current + 1) % pages.length;
      viewer.src = pages[current];
      // 다음 PRELOAD_RANGE개 페이지 프리로드
      preloadNextPages(current);
    }, 600); // fade out 시간과 맞춤
  }

  // interval 시작
  function startInterval() {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(nextPage, intervals[current]);
  }

  // interval 정지
  function stopInterval() {
    clearTimeout(timeoutId);
  }

  // iframe 로드 완료 시
  viewer.onload = function() {
    viewer.classList.remove('fadeout');
    startInterval();
  };

  // 페이지가 숨겨지면 interval 정지, 보이면 재개
  document.addEventListener("visibilitychange", function() {
    if (document.hidden) {
      stopInterval();
    } else {
      startInterval();
    }
  });

  // window unload 시 interval 정리 (메모리 누수 방지)
  window.addEventListener("beforeunload", stopInterval);

  // 초기 시작: 첫번째 프리로드와 interval 시작
  window.onload = function() {
    preloadNextPages(0); // 첫 화면 기준 preload
    startInterval();
  };
</script>
</body>
</html>
